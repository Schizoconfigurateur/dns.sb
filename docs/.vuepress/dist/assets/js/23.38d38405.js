(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{398:function(s,t,a){"use strict";a.r(t);var n=a(27),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"how-to-install-doh-client-on-linux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-to-install-doh-client-on-linux"}},[s._v("#")]),s._v(" How to install DoH client on Linux")]),s._v(" "),a("p",[s._v("We use "),a("a",{attrs:{href:"https://github.com/AdguardTeam/dnsproxy",target:"_blank",rel:"noopener noreferrer"}},[s._v("dnsproxy"),a("OutboundLink")],1),s._v(" from AdguardTeam as DoH Client on Linux system.")]),s._v(" "),a("p",[s._v("DNS Proxy is a simple DNS proxy server that supports all existing DNS protocols including DNS-over-TLS, DNS-over-HTTPS, DNSCrypt, and DNS-over-QUIC. Moreover, it can work as a DNS-over-HTTPS, DNS-over-TLS or DNS-over-QUIC server.")]),s._v(" "),a("h2",{attrs:{id:"_1-install-dns-proxy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-install-dns-proxy"}},[s._v("#")]),s._v(" 1. Install DNS Proxy")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -s https://api.github.com/repos/AdguardTeam/dnsproxy/releases/latest "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" tag_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cut")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"'")]),s._v(" -f "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Latest AdguardTeam dnsproxy version is '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$VERSION")]),s._v('"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O dnsproxy.tar.gz "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://github.com/AdguardTeam/dnsproxy/releases/download/'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION}")]),s._v("/dnsproxy-linux-amd64-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION}")]),s._v('.tar.gz"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xzvf dnsproxy.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" linux-amd64\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" dnsproxy /usr/bin/dnsproxy\n")])])]),a("h2",{attrs:{id:"_2-connect-dns-sb-doh-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-connect-dns-sb-doh-server"}},[s._v("#")]),s._v(" 2. Connect DNS.SB DoH Server")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("dnsproxy -l "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" -u https://doh.dns.sb/dns-query -b "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("185.222")]),s._v(".222.222:53\n")])])]),a("p",[s._v("Now we can open another terminal to test DNS")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("root@dns ~ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dig example.com @127.0.0.1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" DiG "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.16")]),s._v(".15-Debian "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" example.com @127.0.0.1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" global options: +cmd\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Got answer:\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("HEADER"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),s._v(" opcode: QUERY, status: NOERROR, id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22295")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" flags: qr rd ra ad"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" QUERY: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", ANSWER: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", AUTHORITY: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", ADDITIONAL: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" OPT PSEUDOSECTION:\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" EDNS: version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", flags:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" udp: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" QUESTION SECTION:\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("example.com.\t\t\tIN\tA\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" ANSWER SECTION:\nexample.com.\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1094")]),s._v("\tIN\tA\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("93.184")]),s._v(".216.34\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Query time: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" msec\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" SERVER: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53(127.0.0.1)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" WHEN: Fri Jul 02 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":07:43 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" MSG SIZE  rcvd: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v("\n")])])]),a("p",[s._v("We can see the response server  "),a("code",[s._v("SERVER: 127.0.0.1#53(127.0.0.1)")]),s._v(" is working fine.")]),s._v(" "),a("h2",{attrs:{id:"_3-keep-dns-proxy-running-in-background"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-keep-dns-proxy-running-in-background"}},[s._v("#")]),s._v(" 3. Keep DNS Proxy running in background")]),s._v(" "),a("p",[s._v("We use "),a("a",{attrs:{href:"https://github.com/Supervisor/supervisor",target:"_blank",rel:"noopener noreferrer"}},[s._v("Supervisor"),a("OutboundLink")],1),s._v(":")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" supervisor -y\n")])])]),a("p",[s._v("Then create a config file")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/supervisor/conf.d/dnsproxy.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n[program:dnsproxy]\ncommand = dnsproxy -l 127.0.0.1 -p 53 -u https://doh.dns.sb/dns-query -b 185.222.222.222:53\nuser = root\nautostart = true\nautorestart = true\nstdout_logfile = /var/log/supervisor/dnsproxy.log\nstderr_logfile = /var/log/supervisor/dnsproxy.error.log\nenvironment = LANG="en_US.UTF-8"\nEOF')]),s._v("\n")])])]),a("p",[s._v("Now let's restart Supervisor")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl restart supervisor\n")])])]),a("h2",{attrs:{id:"_4-change-etc-resolv-conf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-change-etc-resolv-conf"}},[s._v("#")]),s._v(" 4. Change /etc/resolv.conf")]),s._v(" "),a("p",[s._v("We can use the same method like "),a("RouterLink",{attrs:{to:"/guide/linux/"}},[s._v("How to change DNS settings on Linux")]),s._v(", open "),a("code",[s._v("/etc/resolv.conf")])],1),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/resolv.conf\n")])])]),a("p",[s._v("Replace the "),a("code",[s._v("nameserver")]),s._v(" lines with")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nameserver 127.0.0.1\n")])])]),a("p",[s._v("Save the file and it's working now.")])])}),[],!1,null,null,null);t.default=e.exports}}]);